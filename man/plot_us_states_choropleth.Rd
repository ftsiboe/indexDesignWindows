% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_helpers.R
\name{plot_us_states_choropleth}
\alias{plot_us_states_choropleth}
\title{Plot a US States Choropleth With State-Level Labels}
\usage{
plot_us_states_choropleth(
  data,
  value_lable,
  category_lable,
  legend_title = NULL,
  state_text_colors = c("black", "black"),
  palette = c("#BE5E27", "#FFC425", "#FEF389", "#BED73B", "#A0BD78", "#00583D",
    "#003524", "#D7E5C8", "#9DD9F7", "#51ABA0", "#0F374B"),
  table_grob = NULL,
  label_size = 2.5,
  na.value = "white",
  keep_all_states = FALSE
)
}
\arguments{
\item{data}{A \code{data.frame} containing (at minimum) a \code{state_code} column of
numeric state FIPS codes used to join to the \code{urbnmapr} states map. It must
also contain the columns referenced by \code{value_lable} and \code{category_lable}.}

\item{value_lable}{Character scalar. Name of the column in \code{data} used to
populate the numeric/value portion of the state label (second line).
Values are inserted as-is (not rounded/formatted) and are coerced through
\code{as.data.frame(sf_object)[, value_lable]}.}

\item{category_lable}{Character scalar. Name of the column in \code{data} used for
choropleth fills. Rows with missing values in this column are dropped unless
you set \code{keep_all_states = TRUE} (which still draws all states, but only
colors those present after filtering).}

\item{legend_title}{Character. Legend title for the fill scale. If \code{NULL},
the title is set to an empty string (i.e., no visible title).}

\item{state_text_colors}{Character vector of length 2. The first color is used
for labels on non-small states; the second color is used for repelled labels
on small states.}

\item{palette}{Character vector of hex colours used by \code{scale_fill_manual()}
for the categories in \code{category_lable}.}

\item{table_grob}{Optional grob to embed on the map using \code{annotation_custom()}
(e.g., \code{gridExtra::tableGrob(...)}). If \code{NULL}, no table is added.}

\item{label_size}{Numeric. Text size passed to \code{geom_sf_text()} and
\code{geom_text_repel()}.}

\item{na.value}{Character. Fill color used for missing values when drawing
the basemap (and as \code{na.value} in \code{scale_fill_manual()}).}

\item{keep_all_states}{Logical. If \code{TRUE}, first draws the full U.S. states
basemap in \code{na.value} (so states not present in \code{data} remain visible).
If \code{FALSE}, only the joined/filtered states are drawn.}
}
\value{
A \code{ggplot} object (choropleth of U.S. states) with state labels and
an optional embedded table grob.
}
\description{
Builds a U.S. states choropleth by joining user-supplied state data (by FIPS)
to the \code{urbnmapr} states basemap. States are filled using a categorical column,
and each state is labeled with a two-line label (state abbreviation + a value
column). Labels for small states are placed with repelled text to reduce
overlap, with special nudges for Vermont and New Hampshire. Optionally, a
table grob can be embedded in the lower-left of the map.
}
\details{
The function:
\itemize{
\item Loads the states basemap via \code{urbnmapr::get_urbn_map(map = "states", sf = TRUE)}
and creates a numeric \code{state_code} from \code{state_fips}.
\item Left-joins \code{data} on \code{state_code}, then filters out rows where
\code{category_lable} is \code{NA}.
\item Builds a two-line label of \code{STATE_ABB} plus the \code{value_lable} column.
\item Flags "small" states as those with area < 50,000 km\eqn{^2} (computed
after transforming to EPSG:5070 for equal-area calculations).
\item Uses \code{geom_sf_text()} for non-small states and \code{ggrepel::geom_text_repel()}
for small states, nudging labels left/right based on whether the centroid
lies east or west of the map midpoint; Vermont and New Hampshire get a
custom nudge.
\item Optionally adds \code{table_grob} at fixed map coordinates using
\code{annotation_custom()}.
}
}
