% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_balance.R
\name{compute_balance}
\alias{compute_balance}
\title{Distributional balance: one basis vs multiple comparison variables (long format)}
\usage{
compute_balance(dt, col_x, col_y, by = NULL)
}
\arguments{
\item{dt}{A \code{data.frame} or \code{data.table}.}

\item{col_x}{Character scalar. Name of the \strong{basis} numeric column.}

\item{col_y}{Character vector. Names of one or more \strong{comparison} numeric
columns. The basis variable \code{col_x} is always compared against each
variable in \code{col_y}.}

\item{by}{Optional character vector of grouping variables. If \code{NULL}
(default), all rows are treated as one group.}
}
\value{
A \code{data.table} in \strong{long format} with columns:
\code{c(by,
          "y_level",
          "n", "mean_x", "mean_y", "var_x", "var_y",
          "sd_x", "sd_y", "cv_x", "cv_y", "cv_ratio",
          "mean_bias", "mae", "rmse", "smape",
          "ratio_means", "mpd",
          "msd", "var_ratio", "ks_stat",
          "emd", "hellinger",
          "pvalue_mean", "pvalue_ks", "pvalue_var",
          "pvalue_levene", "pvalue_brown_forsythe", "pvalue_kruskal_wallis",
          "zero_share_x", "zero_share_y", "zero_share_diff",
          "pvalue_zero_mcnemar",
          "mean_logit_x", "mean_logit_y",
          "mean_logit_diff", "rmse_logit", "pvalue_mean_logit",
          "pearson_cor", "spearman_cor", "kendall_cor", "ccc",
          "pvalue_pearson_cor", "pvalue_spearman_cor", "pvalue_kendall_cor",
          "q10_x", "q25_x", "q50_x", "q75_x", "q90_x",
          "q10_y", "q25_y", "q50_y", "q75_y", "q90_y",
          "q10_diff", "q25_diff", "q50_diff", "q75_diff", "q90_diff")}.
}
\description{
For a given \strong{basis} numeric column (\code{col_x}) and one or more \strong{comparison}
numeric columns (\code{col_y}), this function computes a rich set of diagnostics
describing bias, scale, agreement, and distributional differences between
the basis and each comparison variable.

Results are returned in \strong{long format} with one row per group (defined by
\code{by}) and per comparison variable (\code{y_level}).

Metrics include:
\itemize{
\item \strong{Sample size & moments}
\itemize{
\item \code{n}: number of non-missing pairs
\item \code{mean_x}, \code{mean_y}
\item \code{var_x},  \code{var_y}
\item \code{sd_x},   \code{sd_y}
\item \code{cv_x},   \code{cv_y} (coefficients of variation)
}
\item \strong{Bias & scale}
\itemize{
\item \code{mean_bias}   = mean_x - mean_y
\item \code{mae}         = mean(|x - y|)
\item \code{rmse}        = sqrt(mean((x - y)^2))
\item \code{smape}       = 2 * mean(|x - y| / (|x| + |y|)), with safe handling when denominator is zero
\item \code{ratio_means} = mean_x / mean_y
\item \code{cv_ratio}    = cv_x / cv_y
\item \code{mpd}         = mean percentage difference: \deqn{(((\bar{x} - \bar{y}) / \bar{y}) - 1) * 100}
}
\item \strong{Balance / distribution comparison}
\itemize{
\item \code{msd}       = mean standardized difference: (mean_x - mean_y) / sqrt((sd_x^2 + sd_y^2) / 2)
\item \code{var_ratio} = var_x / var_y
\item \code{ks_stat}   = Kolmogorov-Smirnov D-statistic (two-sample)
\item \code{emd}       = 1D Wasserstein / Earth Mover's Distance, approximated as mean absolute difference between quantiles of x and y
\item \code{hellinger} = Hellinger distance computed from common histograms
\item \code{pvalue_mean}           = p-value for equality of means (paired t-test)
\item \code{pvalue_ks}             = p-value from Kolmogorov-Smirnov test
\item \code{pvalue_var}            = p-value from F-test of equal variances
\item \code{pvalue_levene}         = p-value from Levene test (mean-based)
\item \code{pvalue_brown_forsythe} = p-value from Brown-Forsythe test
\item \code{pvalue_kruskal_wallis} = p-value from Kruskal-Wallis test
}
\item \strong{Zero-mass / structural zeros}
\itemize{
\item \code{zero_share_x}   = proportion of observations with x == 0
\item \code{zero_share_y}   = proportion of observations with y == 0
\item \code{zero_share_diff} = zero_share_x - zero_share_y
\item \code{pvalue_zero_mcnemar} = p-value from McNemar test on the paired zero/non-zero indicators
}
\item \strong{Bounded-scale / logit-space (for (0, 1) variables)}
\itemize{
\item \code{mean_logit_x}, \code{mean_logit_y}   = means of logit-transformed x and y
\item \code{mean_logit_diff}                = mean(logit_x - logit_y)
\item \code{rmse_logit}                     = sqrt(mean((logit_x - logit_y)^2))
\item \code{pvalue_mean_logit}              = p-value from paired t-test on logit_x vs logit_y
}

These logit-based metrics are computed only if all non-missing x and y are
in the interval (0, 1). Otherwise, they are returned as NA.
\item \strong{Agreement / association}
\itemize{
\item \code{pearson_cor}      = Pearson correlation
\item \code{spearman_cor}     = Spearman rank correlation
\item \code{kendall_cor}      = Kendall's tau
\item \code{ccc}              = Lin's Concordance Correlation Coefficient
\item \code{pvalue_pearson_cor}
\item \code{pvalue_spearman_cor}
\item \code{pvalue_kendall_cor}
}
\item \strong{Quantile / tail behavior}
\itemize{
\item Quantiles at p = 0.10, 0.25, 0.50, 0.75, 0.90 for x and y:
\code{q10_x}, \code{q25_x}, \code{q50_x}, \code{q75_x}, \code{q90_x}
\code{q10_y}, \code{q25_y}, \code{q50_y}, \code{q75_y}, \code{q90_y}
\item Differences: \code{q10_diff}, \code{q25_diff}, \code{q50_diff}, \code{q75_diff}, \code{q90_diff}
computed as (q_x - q_y)
}
}
}
